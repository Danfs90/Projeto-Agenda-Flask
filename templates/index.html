<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <link rel="stylesheet" href="/static/css/index.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.5/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.5/locales-all.global.min.js"></script>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {

          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          editable: true,
          droppable: true,
          selectable:true,
          selectHelper:true,
          initialView: 'dayGridMonth',
          themeSystem: 'bootstrap5',
          locale: 'pt-br',
          events: [{% for row in calendar %}{ id : '{{row.id}}', title : '{{row.title}}', start : '{{row.start_event}}', end : '{{row.end_event}}', }, {% endfor %}],
          select: function(start, end, allDay)
          {
            openModal(); // Chame a função para abrir o modal
          },

        });
        calendar.setOption('themeSystem', 'bootstrap5');

        calendar.render();
      });

      // Função para abrir o modal
      function openModal() {
        var modal = document.getElementById('eventModal');
        modal.style.display = 'block';

        // Adicione um evento de clique no botão de fechar do modal
        var closeModalButton = document.getElementById('closeModal');
        closeModalButton.addEventListener('click', function() {
          closeModal();
        });
      }

      // Função para fechar o modal
      function closeModal() {
        var modal = document.getElementById('eventModal');
        modal.style.display = 'none';
      }

      // Função para processar o formulário quando for enviado
      document.addEventListener('DOMContentLoaded', function() {
        var eventForm = document.getElementById('eventForm');
        eventForm.addEventListener('submit', function(e) {
          e.preventDefault();

          var title = document.getElementById('eventTitle').value;

          if (title) {

            const now = new Date();
            const isoDate = now.toISOString();
            const start = isoDate.replace('T'," ").slice(0, 19);
            const end = isoDate.replace('T'," ").slice(0, 19);

            $.ajax({
            
              url:"/insert",
              type:"POST",
              
              data:{title:title, start:start, end:end},
              success:function(data)
              {
                //alert(data)
                alert("Added Successfully");
                window.location.replace("/");
              }
              
            })

            closeModal(); // Feche o modal após processar o formulário
          }
        });
      });
    </script>
  </head>
  
  <body>
    <div id='calendar'></div>
  </body>

  <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-sm">
        <h2>Adicionar Evento</h2>
  
        <span class="close" id="closeModal">&times;</span>
  
        <form id="eventForm">
          <label for="eventTitle">Título do Evento:</label>
          <input type="text" id="eventTitle" name="eventTitle" required>
          <button type="submit">Adicionar</button>
        </form>
      </div>
    </div>
  </div>
  
  




  
</html>
